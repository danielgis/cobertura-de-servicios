{"version":3,"sources":["../../../widgets/DynamicSearchWidgetCunaMas/Widget.js"],"names":["declare","BaseWidget","_WidgetsInTemplateMixin","WidgetManager","QueryTask","Query","Deferred","fontAwesome","document","createElement","src","head","appendChild","isFirstLoad","baseClass","groupSelected","urlLayerSelected","postCreate","inherited","arguments","buildMainMenuCs","map","on","executeZoomExtentInitial","bind","onClickGroup","evt","indexGroupSelected","Array","from","target","parentNode","children","indexOf","config","groups","find","group","index","buildFormRadioCs","buildFormSearchCs","buildHeaderSearchCs","containerGroupsApCs","classList","toggle","containerFiltersApCs","onClickBack","destroyFormSearchCs","startup","onOpen","dojo","query","homeWidget","getInstance","getWidgetsByName","setExtent","homeDijit","extent","sort","a","b","containerGridApCs","innerHTML","forEach","img","logo","alt","name","add","setAttribute","label","style","color","description","containerImgSelectedApCs","layersForm","makeSelectorLayers","layers","visible","radioContainerApCs","remove","filters","containerBodyApCs","filter","select","id","codeField","startupData","urlFilter","url","fieldsFilter","nameField","getDataByFilter","then","makeOptionCs","response","features","firstOption","catch","console","error","err","addEventListener","event","onChangeFilterCs","fields","where","distinctValues","deferred","queryTask","outFields","returnGeometry","returnDistinctValues","execute","resolve","reject","promise","setExtentByFilter","self","executeForExtent","expand","options","selectControl","valueField","labelField","defaultOption","text","value","selected","disabled","optionElement","option","attributes","currentFilterIndex","selectedIndex","selectedValue","currentFilter","responseFilter","isZoom","length","geometry","type","centerAndZoom","filterAffected","affectedFilter","affectedIndex","affectedSelect","getElementById","whereFilter","data","filterAffectedReset","resetSelectIndexArray","indexArray","newAffectedFilters","push","flat","formRadioContainersApCs","radioItemContainer","input","layer","checked","for","handleRadioButtonClick","layerSelected","layersId","getLayer","layerId","setVisibility"],"mappings":"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","file":"Widget.js","sourcesContent":["import declare from 'dojo/_base/declare';\r\nimport BaseWidget from 'jimu/BaseWidget';\r\nimport _WidgetsInTemplateMixin from 'dijit/_WidgetsInTemplateMixin';\r\nimport WidgetManager from \"jimu/WidgetManager\"\r\nimport QueryTask from \"esri/tasks/QueryTask\";\r\nimport Query from \"esri/tasks/query\";\r\nimport Deferred from \"dojo/Deferred\";\r\n// import StatisticDefinition from \"esri/tasks/StatisticDefinition\"\r\n\r\nconst fontAwesome = document.createElement('script');\r\nfontAwesome.src = 'https://use.fontawesome.com/releases/v5.3.1/js/all.js';\r\ndocument.head.appendChild(fontAwesome);\r\n\r\nlet isFirstLoad = false;\r\n\r\n// To create a widget, you need to derive from BaseWidget.\r\nexport default declare([BaseWidget], {\r\n\r\n  // Custom widget code goes here\r\n\r\n  baseClass: 'dynamic-search-widget-cuna-mas',\r\n  groupSelected: null,\r\n  urlLayerSelected: null,\r\n\r\n  // add additional properties here\r\n\r\n  // methods to communication with app container:\r\n  postCreate() {\r\n    this.inherited(arguments);\r\n    this.buildMainMenuCs();\r\n    this.map.on(\"update-end\", this.executeZoomExtentInitial.bind(this));\r\n  },\r\n\r\n  onClickGroup(evt) {\r\n    const indexGroupSelected = Array.from(evt.target.parentNode.children).indexOf(evt.target);\r\n    this.groupSelected = this.config.groups.find(group => group.index === indexGroupSelected);\r\n    this.buildFormRadioCs();\r\n    this.buildFormSearchCs();\r\n    this.buildHeaderSearchCs();\r\n    this.containerGroupsApCs.classList.toggle('active');\r\n    this.containerFiltersApCs.classList.toggle('active');\r\n\r\n  },\r\n\r\n  onClickBack(evt) {\r\n    this.containerGroupsApCs.classList.toggle('active');\r\n    this.containerFiltersApCs.classList.toggle('active');\r\n    this.destroyFormSearchCs();\r\n  },\r\n\r\n  startup() {\r\n    this.inherited(arguments);\r\n  },\r\n  onOpen() {\r\n    dojo.query(\".groupFilterClsCs\").on('click', this.onClickGroup.bind(this));\r\n    dojo.query(\".backButtonClsCs\").on('click', this.onClickBack.bind(this));\r\n  },\r\n\r\n  executeZoomExtentInitial() {\r\n    if (isFirstLoad) {\r\n      return;\r\n    }\r\n    const homeWidget = WidgetManager.getInstance().getWidgetsByName(\"HomeButton\");\r\n    this.map.setExtent(homeWidget[0].homeDijit.extent);\r\n    isFirstLoad = true;\r\n  },\r\n\r\n  buildMainMenuCs() {\r\n    this.config.groups.sort((a, b) => a.index - b.index);\r\n    this.containerGridApCs.innerHTML = '';\r\n    this.config.groups.forEach(group => {\r\n      const img = document.createElement('img');\r\n      img.src = group.logo;\r\n      img.alt = group.name;\r\n      img.classList.add('groupFilterClsCs', 'groupCs');\r\n      img.setAttribute('data-dojo-attach-point', 'scdApCs');\r\n      this.containerGridApCs.appendChild(img);\r\n    });\r\n  },\r\n\r\n  buildHeaderSearchCs() {\r\n    dojo.query('#nameSelectedCs')[0].innerHTML = this.groupSelected.label;\r\n    dojo.query('#nameSelectedCs')[0].style.color = this.groupSelected.color;\r\n    dojo.query('#descSelectedCs')[0].innerHTML = this.groupSelected.description;\r\n    dojo.query('#descSelectedCs')[0].style.color = this.groupSelected.color;\r\n    const img = document.createElement('img');\r\n    img.src = this.groupSelected.logo;\r\n    img.alt = this.groupSelected.name;\r\n    img.classList.add('groupFilterClsCs', 'groupCs');\r\n    img.setAttribute('data-dojo-attach-point', 'scdApCs');\r\n    this.containerImgSelectedApCs.innerHTML = '';\r\n    this.containerImgSelectedApCs.appendChild(img);\r\n  },\r\n\r\n  buildFormRadioCs() {\r\n    if (this.groupSelected.layersForm) {\r\n      this.makeSelectorLayers(this.groupSelected.layersForm.layers);\r\n      if (this.groupSelected.layersForm.visible) {\r\n        this.radioContainerApCs.classList.add('active');\r\n      } else {\r\n        this.radioContainerApCs.classList.remove('active');\r\n      }\r\n    } else {\r\n      this.radioContainerApCs.classList.remove('active');\r\n    }\r\n  },\r\n\r\n  buildFormSearchCs() {\r\n    const filters = this.groupSelected.filters;\r\n    filters.sort((a, b) => a.index - b.index);\r\n    this.containerBodyApCs.innerHTML = '';\r\n    filters.forEach((filter, index) => {\r\n      const label = document.createElement('p');\r\n      label.classList.add('labelComboBoxClsCs');\r\n      label.innerHTML = filter.label;\r\n      this.containerBodyApCs.appendChild(label);\r\n\r\n      const select = document.createElement('select');\r\n      select.classList.add('comboBoxClsCs');\r\n      select.id = filter.codeField;\r\n      if (filter.startupData) {\r\n        const urlFilter = this.urlLayerSelected || filter.url;\r\n        const fieldsFilter = [filter.codeField, filter.nameField];\r\n        this.getDataByFilter(urlFilter, fieldsFilter)\r\n          .then(response => {\r\n            this.makeOptionCs(response.features, select, filter.codeField, filter.nameField, filter.firstOption);\r\n          })\r\n          .catch(err => {\r\n            console.error('err', err);\r\n          });\r\n\r\n      };\r\n      select.addEventListener('change', (event) => this.onChangeFilterCs(event, index));\r\n      this.containerBodyApCs.appendChild(select);\r\n    });\r\n  },\r\n\r\n  getDataByFilter(url, fields, where = \"1=1\", distinctValues = true) {\r\n    const deferred = new Deferred();\r\n    const queryTask = new QueryTask(url);\r\n    const query = new Query();\r\n    query.outFields = fields;\r\n    query.where = where;\r\n\r\n    query.returnGeometry = distinctValues ? false : true;\r\n    query.returnDistinctValues = distinctValues;\r\n\r\n    queryTask.execute(query)\r\n      .then(response => {\r\n        deferred.resolve(response);\r\n      })\r\n      .catch(err => {\r\n        deferred.reject(err);\r\n      });\r\n    return deferred.promise;\r\n  },\r\n\r\n  setExtentByFilter(url, where) {\r\n    const self = this;\r\n    const deferred = new Deferred();\r\n    const queryTask = new QueryTask(url);\r\n    const query = new Query();\r\n    query.where = where;\r\n    query.returnGeometry = true;\r\n\r\n    queryTask.executeForExtent(query)\r\n      .then(response => {\r\n        self.map.setExtent(response.extent.expand(1.1), true);\r\n        deferred.resolve(response);\r\n      })\r\n      .catch(err => {\r\n        console.error('err', err);\r\n        deferred.reject(err);\r\n      });\r\n    return deferred.promise;\r\n  },\r\n\r\n  destroyFormSearchCs() {\r\n    this.containerBodyApCs.innerHTML = '';\r\n  },\r\n\r\n  makeOptionCs(options, selectControl, valueField, labelField, firstOption) {\r\n    selectControl.innerHTML = '';\r\n    const defaultOption = document.createElement('option');\r\n    defaultOption.text = firstOption;\r\n    defaultOption.value = '';\r\n    defaultOption.selected = true;\r\n    defaultOption.disabled = true;\r\n    selectControl.appendChild(defaultOption);\r\n    options.forEach(option => {\r\n      const optionElement = document.createElement('option');\r\n      optionElement.value = option.attributes[valueField];\r\n      optionElement.innerHTML = option.attributes[labelField];\r\n      selectControl.appendChild(optionElement);\r\n    });\r\n  },\r\n\r\n  onChangeFilterCs(evt, currentFilterIndex) {\r\n    const selectedIndex = evt.target.selectedIndex;\r\n    const selectedValue = evt.target.options[selectedIndex].value;\r\n    const currentFilter = this.groupSelected.filters[currentFilterIndex];\r\n\r\n    const fields = [currentFilter.codeField, currentFilter.nameField];\r\n    const where = `${currentFilter.codeField} = '${selectedValue}'`;\r\n\r\n    let responseFilter;\r\n\r\n    const url = this.urlLayerSelected || currentFilter.url;\r\n    return this.getDataByFilter(url, fields, where, false)\r\n      .then((response) => {\r\n        responseFilter = response;\r\n        if (!currentFilter.isZoom) {\r\n          return null;\r\n        }\r\n        if (responseFilter.features.length === 1 && responseFilter.features[0].geometry.type === 'point') {\r\n          return this.map.centerAndZoom(responseFilter.features[0].geometry, 17);\r\n        }\r\n        return this.setExtentByFilter(url, where);\r\n      })\r\n      .then(() => {\r\n        if (!currentFilter.filterAffected) {\r\n          return;\r\n        }\r\n        currentFilter.filterAffected.forEach(affectedIndex => {\r\n          const affectedFilter = this.groupSelected.filters[affectedIndex];\r\n          const affectedSelect = document.getElementById(affectedFilter.codeField);\r\n          const urlFilter = this.urlLayerSelected || affectedFilter.url;\r\n          const fieldsFilter = [affectedFilter.codeField, affectedFilter.nameField];\r\n          const whereFilter = `${currentFilter.codeField} = '${selectedValue}'`;\r\n          this.getDataByFilter(urlFilter, fieldsFilter, whereFilter)\r\n            .then(data => {\r\n              this.makeOptionCs(data.features, affectedSelect, affectedFilter.codeField, affectedFilter.nameField, affectedFilter.firstOption);\r\n            })\r\n            .then(() => {\r\n              let filterAffectedReset = affectedFilter.filterAffected;\r\n              while (filterAffectedReset.length > 0) {\r\n                filterAffectedReset = this.resetSelectIndexArray(filterAffectedReset);\r\n              }\r\n            })\r\n            .catch(err => {\r\n              console.error(`Error al actualizar el filtro ${affectedFilter.label}:`, err);\r\n            });\r\n        });\r\n      })\r\n      .catch(err => {\r\n        console.error('err', err);\r\n      });\r\n  },\r\n\r\n  resetSelectIndexArray(indexArray) {\r\n    const newAffectedFilters = [];\r\n    this.groupSelected.filters.forEach(filter => {\r\n      indexArray.forEach(index => {\r\n        if (filter.index === index) {\r\n          const select = document.getElementById(filter.codeField);\r\n          select.innerHTML = '';\r\n          const defaultOption = document.createElement('option');\r\n          defaultOption.text = filter.firstOption;\r\n          defaultOption.value = '';\r\n          select.appendChild(defaultOption);\r\n          newAffectedFilters.push(filter.filterAffected);\r\n        }\r\n      });\r\n    });\r\n\r\n    return newAffectedFilters.flat();\r\n  },\r\n\r\n  makeSelectorLayers(layers) {\r\n    layers.sort((a, b) => a.index - b.index);\r\n    this.formRadioContainersApCs.innerHTML = '';\r\n\r\n    layers.forEach(layer => {\r\n      const radioItemContainer = document.createElement('div');\r\n      radioItemContainer.classList.add('radioItemContainerCs');\r\n      const input = document.createElement('input');\r\n      input.type = 'radio';\r\n      input.name = 'searchType';\r\n      input.id = layer.id;\r\n      if (layer.selected) {\r\n        input.checked = true;\r\n      }\r\n      radioItemContainer.appendChild(input);\r\n      const label = document.createElement('label');\r\n      label.for = layer.id;\r\n      label.innerHTML = layer.label;\r\n      radioItemContainer.appendChild(label);\r\n      this.formRadioContainersApCs.appendChild(radioItemContainer);\r\n    });\r\n    dojo.query('.radioItemContainerCs input').on('click', this.handleRadioButtonClick.bind(this));\r\n  },\r\n\r\n  handleRadioButtonClick(event) {\r\n    const layerSelected = this.groupSelected.layersForm.layers.find(layer => layer.id === event.target.id);\r\n    if (layerSelected) {\r\n      this.groupSelected.layersForm.layers.forEach(layer => {\r\n        if (layer.id === event.target.id) {\r\n          layer.selected = true;\r\n        } else {\r\n          layer.selected = false;\r\n          layer.layersId.forEach(layerId => {\r\n            this.map.getLayer(layerId).setVisibility(false)\r\n          });\r\n        }\r\n      });\r\n      layerSelected.layersId.forEach(layerId => {\r\n        this.map.getLayer(layerId).setVisibility(true)\r\n      });\r\n      this.urlLayerSelected = this.map.getLayer(layerSelected.layersId[0]).url;\r\n    }\r\n  },\r\n\r\n\r\n\r\n  // onClose(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onClose');\r\n  // },\r\n  // onMinimize(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onMinimize');\r\n  // },\r\n  // onMaximize(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onMaximize');\r\n  // },\r\n  // onSignIn(credential){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onSignIn', credential);\r\n  // },\r\n  // onSignOut(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onSignOut');\r\n  // }\r\n  // onPositionChange(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onPositionChange');\r\n  // },\r\n  // resize(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::resize');\r\n  // }\r\n});\r\n"]}