{"version":3,"sources":["../../../widgets/DynamicSearchWidgetCunaMas/Widget.js"],"names":["declare","BaseWidget","_WidgetsInTemplateMixin","WidgetManager","QueryTask","Query","Deferred","fontAwesome","document","createElement","src","head","appendChild","isFirstLoad","baseClass","groupSelected","urlLayerSelected","postCreate","inherited","arguments","map","on","executeZoomExtentInitial","bind","onClickGroup","evt","indexGroupSelected","Array","from","target","parentNode","children","indexOf","config","groups","find","group","index","buildFormRadioCs","buildFormSearchCs","buildHeaderSearchCs","containerGroupsApCs","classList","toggle","containerFiltersApCs","onClickBack","destroyFormSearchCs","startup","onOpen","buildMainMenuCs","dojo","query","homeWidget","getInstance","getWidgetsByName","setExtent","homeDijit","extent","sort","a","b","containerGridApCs","innerHTML","length","containerBackApCs","remove","forEach","img","logo","alt","name","add","setAttribute","label","style","color","description","containerImgSelectedApCs","layersForm","makeSelectorLayers","layers","visible","radioContainerApCs","filters","containerBodyApCs","filter","select","id","codeField","startupData","urlFilter","url","fieldsFilter","nameField","getDataByFilter","then","makeOptionCs","response","features","firstOption","catch","console","error","err","addEventListener","event","onChangeFilterCs","fields","where","distinctValues","deferred","queryTask","outFields","returnGeometry","returnDistinctValues","execute","resolve","reject","promise","setExtentByFilter","self","executeForExtent","expand","destroyFormRadioCs","options","selectControl","valueField","labelField","defaultOption","text","value","selected","disabled","optionElement","option","attributes","currentFilterIndex","selectedIndex","selectedValue","currentFilter","responseFilter","isZoom","geometry","type","centerAndZoom","filterAffected","affectedFilter","affectedIndex","affectedSelect","getElementById","whereFilter","data","filterAffectedReset","resetSelectIndexArray","indexArray","newAffectedFilters","push","flat","formRadioContainersApCs","idSelected","radioItemContainer","input","layer","for","handleRadioButtonClick","checked","click","layerSelected","layersId","getLayer","layerId","setVisibility"],"mappings":"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","file":"Widget.js","sourcesContent":["import declare from 'dojo/_base/declare';\r\nimport BaseWidget from 'jimu/BaseWidget';\r\nimport _WidgetsInTemplateMixin from 'dijit/_WidgetsInTemplateMixin';\r\nimport WidgetManager from \"jimu/WidgetManager\"\r\nimport QueryTask from \"esri/tasks/QueryTask\";\r\nimport Query from \"esri/tasks/query\";\r\nimport Deferred from \"dojo/Deferred\";\r\n// import StatisticDefinition from \"esri/tasks/StatisticDefinition\"\r\n\r\nconst fontAwesome = document.createElement('script');\r\nfontAwesome.src = 'https://use.fontawesome.com/releases/v5.3.1/js/all.js';\r\ndocument.head.appendChild(fontAwesome);\r\n\r\nlet isFirstLoad = false;\r\n\r\n// To create a widget, you need to derive from BaseWidget.\r\nexport default declare([BaseWidget], {\r\n\r\n  // Custom widget code goes here\r\n\r\n  baseClass: 'dynamic-search-widget-cuna-mas',\r\n  groupSelected: null,\r\n  urlLayerSelected: null,\r\n\r\n  // add additional properties here\r\n\r\n  // methods to communication with app container:\r\n  postCreate() {\r\n    this.inherited(arguments);\r\n    this.map.on(\"update-end\", this.executeZoomExtentInitial.bind(this));\r\n  },\r\n\r\n  onClickGroup(evt) {\r\n    const indexGroupSelected = Array.from(evt.target.parentNode.children).indexOf(evt.target);\r\n    this.groupSelected = this.config.groups.find(group => group.index === indexGroupSelected);\r\n    this.buildFormRadioCs();\r\n    this.buildFormSearchCs();\r\n    this.buildHeaderSearchCs();\r\n    this.containerGroupsApCs.classList.toggle('active');\r\n    this.containerFiltersApCs.classList.toggle('active');\r\n  },\r\n\r\n  onClickBack(evt) {\r\n    this.containerGroupsApCs.classList.toggle('active');\r\n    this.containerFiltersApCs.classList.toggle('active');\r\n    this.destroyFormSearchCs();\r\n    this.urlLayerSelected = null;\r\n  },\r\n\r\n  startup() {\r\n    this.inherited(arguments);\r\n  },\r\n  onOpen() {\r\n    this.buildMainMenuCs();\r\n    dojo.query(\".groupFilterClsCs\").on('click', this.onClickGroup.bind(this));\r\n    dojo.query(\".backButtonClsCs\").on('click', this.onClickBack.bind(this));\r\n  },\r\n\r\n  executeZoomExtentInitial() {\r\n    if (isFirstLoad) {\r\n      return;\r\n    }\r\n    const homeWidget = WidgetManager.getInstance().getWidgetsByName(\"HomeButton\");\r\n    this.map.setExtent(homeWidget[0].homeDijit.extent);\r\n    isFirstLoad = true;\r\n  },\r\n\r\n  buildMainMenuCs() {\r\n    this.config.groups.sort((a, b) => a.index - b.index);\r\n    this.containerGridApCs.innerHTML = '';\r\n    if (this.config.groups.length == 1) {\r\n      this.groupSelected = this.config.groups[0];\r\n      this.containerBackApCs.classList.remove('active');\r\n      this.buildFormRadioCs();\r\n      this.buildFormSearchCs();\r\n      this.buildHeaderSearchCs();\r\n      this.containerGroupsApCs.classList.toggle('active');\r\n      this.containerFiltersApCs.classList.toggle('active');\r\n      return;\r\n    }\r\n    this.config.groups.forEach(group => {\r\n      const img = document.createElement('img');\r\n      img.src = group.logo;\r\n      img.alt = group.name;\r\n      img.classList.add('groupFilterClsCs', 'groupCs');\r\n      img.setAttribute('data-dojo-attach-point', 'scdApCs');\r\n      this.containerGridApCs.appendChild(img);\r\n    });\r\n  },\r\n\r\n  buildHeaderSearchCs() {\r\n    dojo.query('#nameSelectedCs')[0].innerHTML = this.groupSelected.label;\r\n    dojo.query('#nameSelectedCs')[0].style.color = this.groupSelected.color;\r\n    dojo.query('#descSelectedCs')[0].innerHTML = this.groupSelected.description;\r\n    dojo.query('#descSelectedCs')[0].style.color = this.groupSelected.color;\r\n    const img = document.createElement('img');\r\n    img.src = this.groupSelected.logo;\r\n    img.alt = this.groupSelected.name;\r\n    img.classList.add('groupFilterClsCs', 'groupCs');\r\n    img.setAttribute('data-dojo-attach-point', 'scdApCs');\r\n    this.containerImgSelectedApCs.innerHTML = '';\r\n    this.containerImgSelectedApCs.appendChild(img);\r\n  },\r\n\r\n  buildFormRadioCs() {\r\n    if (this.groupSelected.layersForm) {\r\n      this.makeSelectorLayers(this.groupSelected.layersForm.layers);\r\n      if (this.groupSelected.layersForm.visible) {\r\n        this.radioContainerApCs.classList.add('active');\r\n      } else {\r\n        this.radioContainerApCs.classList.remove('active');\r\n      }\r\n    } else {\r\n      this.radioContainerApCs.classList.remove('active');\r\n    }\r\n  },\r\n\r\n  buildFormSearchCs() {\r\n    const filters = this.groupSelected.filters;\r\n    filters.sort((a, b) => a.index - b.index);\r\n    this.containerBodyApCs.innerHTML = '';\r\n    filters.forEach((filter, index) => {\r\n      const label = document.createElement('p');\r\n      label.classList.add('labelComboBoxClsCs');\r\n      label.innerHTML = filter.label;\r\n      this.containerBodyApCs.appendChild(label);\r\n\r\n      const select = document.createElement('select');\r\n      select.classList.add('comboBoxClsCs');\r\n      select.id = filter.codeField;\r\n      if (filter.startupData) {\r\n        const urlFilter = this.urlLayerSelected || filter.url;\r\n        const fieldsFilter = [filter.codeField, filter.nameField];\r\n        this.getDataByFilter(urlFilter, fieldsFilter)\r\n          .then(response => {\r\n            this.makeOptionCs(response.features, select, filter.codeField, filter.nameField, filter.firstOption);\r\n          })\r\n          .catch(err => {\r\n            console.error('err', err);\r\n          });\r\n\r\n      };\r\n      select.addEventListener('change', (event) => this.onChangeFilterCs(event, index));\r\n      this.containerBodyApCs.appendChild(select);\r\n    });\r\n  },\r\n\r\n  getDataByFilter(url, fields, where = \"1=1\", distinctValues = true) {\r\n    const deferred = new Deferred();\r\n    const queryTask = new QueryTask(url);\r\n    const query = new Query();\r\n    query.outFields = fields;\r\n    query.where = where;\r\n\r\n    query.returnGeometry = distinctValues ? false : true;\r\n    query.returnDistinctValues = distinctValues;\r\n\r\n    queryTask.execute(query)\r\n      .then(response => {\r\n        deferred.resolve(response);\r\n      })\r\n      .catch(err => {\r\n        deferred.reject(err);\r\n      });\r\n    return deferred.promise;\r\n  },\r\n\r\n  setExtentByFilter(url, where) {\r\n    const self = this;\r\n    const deferred = new Deferred();\r\n    const queryTask = new QueryTask(url);\r\n    const query = new Query();\r\n    query.where = where;\r\n    query.returnGeometry = true;\r\n\r\n    queryTask.executeForExtent(query)\r\n      .then(response => {\r\n        self.map.setExtent(response.extent.expand(1.1), true);\r\n        deferred.resolve(response);\r\n      })\r\n      .catch(err => {\r\n        console.error('err', err);\r\n        deferred.reject(err);\r\n      });\r\n    return deferred.promise;\r\n  },\r\n\r\n  destroyFormSearchCs() {\r\n    this.containerBodyApCs.innerHTML = '';\r\n  },\r\n\r\n  destroyFormRadioCs() {\r\n    this.radioContainerApCs.innerHTML = '';\r\n  },\r\n\r\n  makeOptionCs(options, selectControl, valueField, labelField, firstOption) {\r\n    selectControl.innerHTML = '';\r\n    const defaultOption = document.createElement('option');\r\n    defaultOption.text = firstOption;\r\n    defaultOption.value = '';\r\n    defaultOption.selected = true;\r\n    defaultOption.disabled = true;\r\n    selectControl.appendChild(defaultOption);\r\n    options.forEach(option => {\r\n      const optionElement = document.createElement('option');\r\n      optionElement.value = option.attributes[valueField];\r\n      optionElement.innerHTML = option.attributes[labelField];\r\n      selectControl.appendChild(optionElement);\r\n    });\r\n  },\r\n\r\n  onChangeFilterCs(evt, currentFilterIndex) {\r\n    const selectedIndex = evt.target.selectedIndex;\r\n    const selectedValue = evt.target.options[selectedIndex].value;\r\n    const currentFilter = this.groupSelected.filters[currentFilterIndex];\r\n\r\n    const fields = [currentFilter.codeField, currentFilter.nameField];\r\n    const where = `${currentFilter.codeField} = '${selectedValue}'`;\r\n\r\n    let responseFilter;\r\n\r\n    const url = this.urlLayerSelected || currentFilter.url;\r\n    return this.getDataByFilter(url, fields, where, false)\r\n      .then((response) => {\r\n        responseFilter = response;\r\n        if (!currentFilter.isZoom) {\r\n          return null;\r\n        }\r\n        if (responseFilter.features.length === 1 && responseFilter.features[0].geometry.type === 'point') {\r\n          return this.map.centerAndZoom(responseFilter.features[0].geometry, 17);\r\n        }\r\n        return this.setExtentByFilter(url, where);\r\n      })\r\n      .then(() => {\r\n        if (!currentFilter.filterAffected) {\r\n          return;\r\n        }\r\n        currentFilter.filterAffected.forEach(affectedIndex => {\r\n          const affectedFilter = this.groupSelected.filters[affectedIndex];\r\n          const affectedSelect = document.getElementById(affectedFilter.codeField);\r\n          const urlFilter = this.urlLayerSelected || affectedFilter.url;\r\n          const fieldsFilter = [affectedFilter.codeField, affectedFilter.nameField];\r\n          const whereFilter = `${currentFilter.codeField} = '${selectedValue}'`;\r\n          this.getDataByFilter(urlFilter, fieldsFilter, whereFilter)\r\n            .then(data => {\r\n              this.makeOptionCs(data.features, affectedSelect, affectedFilter.codeField, affectedFilter.nameField, affectedFilter.firstOption);\r\n            })\r\n            .then(() => {\r\n              let filterAffectedReset = affectedFilter.filterAffected;\r\n              while (filterAffectedReset.length > 0) {\r\n                filterAffectedReset = this.resetSelectIndexArray(filterAffectedReset);\r\n              }\r\n            })\r\n            .catch(err => {\r\n              console.error(`Error al actualizar el filtro ${affectedFilter.label}:`, err);\r\n            });\r\n        });\r\n      })\r\n      .catch(err => {\r\n        console.error('err', err);\r\n      });\r\n  },\r\n\r\n  resetSelectIndexArray(indexArray) {\r\n    const newAffectedFilters = [];\r\n    this.groupSelected.filters.forEach(filter => {\r\n      indexArray.forEach(index => {\r\n        if (filter.index === index) {\r\n          const select = document.getElementById(filter.codeField);\r\n          select.innerHTML = '';\r\n          const defaultOption = document.createElement('option');\r\n          defaultOption.text = filter.firstOption;\r\n          defaultOption.value = '';\r\n          select.appendChild(defaultOption);\r\n          newAffectedFilters.push(filter.filterAffected);\r\n        }\r\n      });\r\n    });\r\n\r\n    return newAffectedFilters.flat();\r\n  },\r\n\r\n  makeSelectorLayers(layers) {\r\n    layers.sort((a, b) => a.index - b.index);\r\n    this.formRadioContainersApCs.innerHTML = '';\r\n\r\n    let idSelected;\r\n\r\n    layers.forEach(layer => {\r\n      const radioItemContainer = document.createElement('div');\r\n      radioItemContainer.classList.add('radioItemContainerCs');\r\n      const input = document.createElement('input');\r\n      input.type = 'radio';\r\n      input.name = 'searchType';\r\n      input.id = layer.id;\r\n      if (layer.selected) {\r\n        idSelected = layer.id;\r\n      };\r\n      radioItemContainer.appendChild(input);\r\n      const label = document.createElement('label');\r\n      label.for = layer.id;\r\n      label.innerHTML = layer.label;\r\n      radioItemContainer.appendChild(label);\r\n      this.formRadioContainersApCs.appendChild(radioItemContainer);\r\n    });\r\n    dojo.query('.radioItemContainerCs input').on('click', this.handleRadioButtonClick.bind(this));\r\n    // execute event ckecked the radio button selected by id programmatically in dom\r\n    if (idSelected) {\r\n      document.getElementById(idSelected).checked = true;\r\n      document.getElementById(idSelected).click();\r\n    };\r\n  },\r\n\r\n  handleRadioButtonClick(event) {\r\n    const layerSelected = this.groupSelected.layersForm.layers.find(layer => layer.id === event.target.id);\r\n    if (layerSelected) {\r\n      this.groupSelected.layersForm.layers.forEach(layer => {\r\n        if (layer.id === event.target.id) {\r\n          // layer.selected = true;\r\n        } else {\r\n          // layer.selected = false;\r\n          layer.layersId.forEach(layerId => {\r\n            if (this.map.getLayer(layerId).visible & layerSelected.layersId[0] != layerId) {\r\n              this.map.getLayer(layerId).setVisibility(false)\r\n            };\r\n          });\r\n        }\r\n      });\r\n      layerSelected.layersId.forEach(layerId => {\r\n        if (!this.map.getLayer(layerId).visible) {\r\n          this.map.getLayer(layerId).setVisibility(true);\r\n        };\r\n      });\r\n      this.urlLayerSelected = this.map.getLayer(layerSelected.layersId[0]).url;\r\n    }\r\n  },\r\n\r\n\r\n\r\n  // onClose(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onClose');\r\n  // },\r\n  // onMinimize(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onMinimize');\r\n  // },\r\n  // onMaximize(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onMaximize');\r\n  // },\r\n  // onSignIn(credential){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onSignIn', credential);\r\n  // },\r\n  // onSignOut(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onSignOut');\r\n  // }\r\n  // onPositionChange(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onPositionChange');\r\n  // },\r\n  // resize(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::resize');\r\n  // }\r\n});\r\n"]}