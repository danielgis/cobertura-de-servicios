{"version":3,"sources":["../../../widgets/DynamicSearchWidgetCunaMas/Widget.js"],"names":["declare","BaseWidget","_WidgetsInTemplateMixin","WidgetManager","QueryTask","Query","Deferred","fontAwesome","document","createElement","src","head","appendChild","isFirstLoad","baseClass","groupSelected","postCreate","inherited","arguments","buildMainMenuCs","map","on","executeZoomExtentInitial","bind","onClickGroup","evt","indexGroupSelected","Array","from","target","parentNode","children","indexOf","config","groups","find","group","index","buildFormSearchCs","buildHeaderSearchCs","containerGroupsApCs","classList","toggle","containerFiltersApCs","onClickBack","destroyFormSearchCs","startup","onOpen","dojo","query","homeWidget","getInstance","getWidgetsByName","setExtent","homeDijit","extent","sort","a","b","containerGridApCs","innerHTML","forEach","img","logo","alt","name","add","setAttribute","label","description","containerImgSelectedApCs","filters","containerBodyApCs","filter","select","id","codeField","startupData","getDataByFilter","url","nameField","then","makeOptionCs","response","features","catch","console","error","err","addEventListener","event","onChangeFilterCs","fields","where","distinctValues","deferred","queryTask","outFields","returnGeometry","returnDistinctValues","execute","resolve","reject","promise","setExtentByFilter","self","executeForExtent","expand","options","selectControl","valueField","labelField","optionElement","value","option","attributes","currentFilterIndex","selectedIndex","selectedValue","currentFilter","responseFilter","isZoom","length","geometry","type","centerAndZoom","filterAffected","affectedFilter","affectedIndex","affectedSelect","getElementById","defaultOption","text","firstOption","data"],"mappings":"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","file":"Widget.js","sourcesContent":["import declare from 'dojo/_base/declare';\r\nimport BaseWidget from 'jimu/BaseWidget';\r\nimport _WidgetsInTemplateMixin from 'dijit/_WidgetsInTemplateMixin';\r\nimport WidgetManager from \"jimu/WidgetManager\"\r\nimport QueryTask from \"esri/tasks/QueryTask\";\r\nimport Query from \"esri/tasks/query\";\r\nimport Deferred from \"dojo/Deferred\";\r\n// import StatisticDefinition from \"esri/tasks/StatisticDefinition\"\r\n\r\nconst fontAwesome = document.createElement('script');\r\nfontAwesome.src = 'https://use.fontawesome.com/releases/v5.3.1/js/all.js';\r\ndocument.head.appendChild(fontAwesome);\r\n\r\nlet isFirstLoad = false;\r\n\r\n// To create a widget, you need to derive from BaseWidget.\r\nexport default declare([BaseWidget], {\r\n\r\n  // Custom widget code goes here\r\n\r\n  baseClass: 'dynamic-search-widget-cuna-mas',\r\n  groupSelected: null,\r\n\r\n  // add additional properties here\r\n\r\n  // methods to communication with app container:\r\n  postCreate() {\r\n    this.inherited(arguments);\r\n    this.buildMainMenuCs();\r\n    this.map.on(\"update-end\", this.executeZoomExtentInitial.bind(this));\r\n  },\r\n\r\n  onClickGroup(evt) {\r\n    const indexGroupSelected = Array.from(evt.target.parentNode.children).indexOf(evt.target);\r\n    // search group by property index\r\n    this.groupSelected = this.config.groups.find(group => group.index === indexGroupSelected);\r\n    // console.log('indexGroupSelected', this.indexGroupSelected);\r\n    this.buildFormSearchCs();\r\n    this.buildHeaderSearchCs();\r\n    this.containerGroupsApCs.classList.toggle('active');\r\n    this.containerFiltersApCs.classList.toggle('active');\r\n\r\n  },\r\n\r\n  onClickBack(evt) {\r\n    this.containerGroupsApCs.classList.toggle('active');\r\n    this.containerFiltersApCs.classList.toggle('active');\r\n    this.destroyFormSearchCs();\r\n  },\r\n\r\n  startup() {\r\n    this.inherited(arguments);\r\n  },\r\n  onOpen() {\r\n    dojo.query(\".groupFilterClsCs\").on('click', this.onClickGroup.bind(this));\r\n    dojo.query(\".backButtonClsCs\").on('click', this.onClickBack.bind(this));\r\n  },\r\n\r\n  executeZoomExtentInitial() {\r\n    if (isFirstLoad) {\r\n      return;\r\n    }\r\n    const homeWidget = WidgetManager.getInstance().getWidgetsByName(\"HomeButton\");\r\n    this.map.setExtent(homeWidget[0].homeDijit.extent);\r\n    isFirstLoad = true;\r\n  },\r\n\r\n  buildMainMenuCs() {\r\n    this.config.groups.sort((a, b) => a.index - b.index);\r\n    this.containerGridApCs.innerHTML = '';\r\n    this.config.groups.forEach(group => {\r\n      const img = document.createElement('img');\r\n      img.src = group.logo;\r\n      img.alt = group.name;\r\n      img.classList.add('groupFilterClsCs', 'groupCs');\r\n      img.setAttribute('data-dojo-attach-point', 'scdApCs');\r\n      this.containerGridApCs.appendChild(img);\r\n    });\r\n  },\r\n\r\n  buildHeaderSearchCs() {\r\n    dojo.query('#nameSelectedCs')[0].innerHTML = this.groupSelected.label;\r\n    dojo.query('#descSelectedCs')[0].innerHTML = this.groupSelected.description;\r\n    const img = document.createElement('img');\r\n    img.src = this.groupSelected.logo;\r\n    img.alt = this.groupSelected.name;\r\n    img.classList.add('groupFilterClsCs', 'groupCs');\r\n    img.setAttribute('data-dojo-attach-point', 'scdApCs');\r\n    this.containerImgSelectedApCs.innerHTML = '';\r\n    this.containerImgSelectedApCs.appendChild(img);\r\n  },\r\n\r\n  buildFormSearchCs() {\r\n    const filters = this.groupSelected.filters;\r\n    filters.sort((a, b) => a.index - b.index);\r\n    this.containerBodyApCs.innerHTML = '';\r\n    filters.forEach((filter, index) => {\r\n      const label = document.createElement('p');\r\n      label.classList.add('labelComboBoxClsCs');\r\n      label.innerHTML = filter.label;\r\n      this.containerBodyApCs.appendChild(label);\r\n\r\n      const select = document.createElement('select');\r\n      select.classList.add('comboBoxClsCs');\r\n      select.id = filter.codeField;\r\n      if (filter.startupData) {\r\n        this.getDataByFilter(filter.url, [filter.codeField, filter.nameField])\r\n          .then(response => {\r\n            this.makeOptionCs(response.features, select, filter.codeField, filter.nameField);\r\n          })\r\n          .catch(err => {\r\n            console.error('err', err);\r\n          });\r\n\r\n      };\r\n      select.addEventListener('change', (event) => this.onChangeFilterCs(event, index));\r\n      this.containerBodyApCs.appendChild(select);\r\n    });\r\n  },\r\n\r\n  getDataByFilter(url, fields, where = \"1=1\", distinctValues = true) {\r\n    const deferred = new Deferred();\r\n    const queryTask = new QueryTask(url);\r\n    const query = new Query();\r\n    query.outFields = fields;\r\n    query.where = where;\r\n\r\n    query.returnGeometry = distinctValues ? false : true;\r\n    query.returnDistinctValues = distinctValues;\r\n\r\n    queryTask.execute(query)\r\n      .then(response => {\r\n        deferred.resolve(response);\r\n      })\r\n      .catch(err => {\r\n        deferred.reject(err);\r\n      });\r\n    return deferred.promise;\r\n  },\r\n\r\n  setExtentByFilter(url, where) {\r\n    const self = this;\r\n    const deferred = new Deferred();\r\n    const queryTask = new QueryTask(url);\r\n    const query = new Query();\r\n    query.where = where;\r\n    query.returnGeometry = true;\r\n\r\n    queryTask.executeForExtent(query)\r\n      .then(response => {\r\n        self.map.setExtent(response.extent.expand(1.1), true);\r\n        deferred.resolve(response);\r\n      })\r\n      .catch(err => {\r\n        console.error('err', err);\r\n        deferred.reject(err);\r\n      });\r\n    return deferred.promise;\r\n  },\r\n\r\n  destroyFormSearchCs() {\r\n    this.containerBodyApCs.innerHTML = '';\r\n  },\r\n\r\n  makeOptionCs(options, selectControl, valueField, labelField) {\r\n    options.forEach(option => {\r\n      const optionElement = document.createElement('option');\r\n      optionElement.value = option.attributes[valueField];\r\n      optionElement.innerHTML = option.attributes[labelField];\r\n      selectControl.appendChild(optionElement);\r\n    });\r\n  },\r\n\r\n  onChangeFilterCs(evt, currentFilterIndex) {\r\n    const selectedIndex = evt.target.selectedIndex;\r\n    const selectedValue = evt.target.options[selectedIndex].value;\r\n    const currentFilter = this.groupSelected.filters[currentFilterIndex];\r\n\r\n    const fields = [currentFilter.codeField, currentFilter.nameField];\r\n    const where = `${currentFilter.codeField} = '${selectedValue}'`;\r\n\r\n    let responseFilter;\r\n\r\n    return this.getDataByFilter(currentFilter.url, fields, where, false)\r\n      .then((response) => {\r\n        responseFilter = response;\r\n        if (!currentFilter.isZoom) {\r\n          return null;\r\n        }\r\n        if (responseFilter.features.length === 1 && responseFilter.features[0].geometry.type === 'point') {\r\n          return this.map.centerAndZoom(responseFilter.features[0].geometry, 17);\r\n        }\r\n        return this.setExtentByFilter(currentFilter.url, where);\r\n      })\r\n      .then(() => {\r\n        if (!currentFilter.filterAffected) {\r\n          return;\r\n        }\r\n        currentFilter.filterAffected.forEach(affectedIndex => {\r\n          const affectedFilter = this.groupSelected.filters[affectedIndex];\r\n          const affectedSelect = document.getElementById(affectedFilter.codeField);\r\n          affectedSelect.innerHTML = '';\r\n          const defaultOption = document.createElement('option');\r\n          defaultOption.text = affectedFilter.firstOption;\r\n          defaultOption.value = '';\r\n          affectedSelect.appendChild(defaultOption);\r\n          this.getDataByFilter(affectedFilter.url, [affectedFilter.codeField, affectedFilter.nameField], `${currentFilter.codeField} = '${selectedValue}'`)\r\n            .then(data => {\r\n              this.makeOptionCs(data.features, affectedSelect, affectedFilter.codeField, affectedFilter.nameField);\r\n            })\r\n            .catch(err => {\r\n              console.error(`Error al actualizar el filtro ${affectedFilter.label}:`, err);\r\n            });\r\n        });\r\n      })\r\n      .catch(err => {\r\n        console.error('err', err);\r\n      });\r\n  },\r\n\r\n\r\n\r\n\r\n\r\n  // onClose(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onClose');\r\n  // },\r\n  // onMinimize(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onMinimize');\r\n  // },\r\n  // onMaximize(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onMaximize');\r\n  // },\r\n  // onSignIn(credential){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onSignIn', credential);\r\n  // },\r\n  // onSignOut(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onSignOut');\r\n  // }\r\n  // onPositionChange(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onPositionChange');\r\n  // },\r\n  // resize(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::resize');\r\n  // }\r\n});\r\n"]}