{"version":3,"sources":["../../../widgets/DynamicSearchWidgetCunaMas/Widget.js"],"names":["declare","BaseWidget","_WidgetsInTemplateMixin","WidgetManager","QueryTask","Query","Deferred","StatisticDefinition","fontAwesome","document","createElement","src","head","appendChild","isFirstLoad","baseClass","postCreate","inherited","arguments","map","on","executeZoomExtentInitial","bind","onClickGroup","evt","containerGroupsApCs","classList","toggle","containerFiltersApCs","buildFormSearchCs","onClickBack","destroyFormSearchCs","startup","onOpen","dojo","query","homeWidget","getInstance","getWidgetsByName","setExtent","homeDijit","extent","filters","config","groups","sort","a","b","index","containerBodyApCs","innerHTML","promise","Promise","resolve","forEach","filter","label","add","select","id","codeField","startupData","then","getDataByFilter","url","nameField","response","features","option","value","feature","attributes","catch","console","error","err","fields","where","deferred","queryTask","outFields","returnDistinctValues","execute","log","reject"],"mappings":"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","file":"Widget.js","sourcesContent":["import declare from 'dojo/_base/declare';\r\nimport BaseWidget from 'jimu/BaseWidget';\r\nimport _WidgetsInTemplateMixin from 'dijit/_WidgetsInTemplateMixin';\r\nimport WidgetManager from \"jimu/WidgetManager\"\r\nimport QueryTask from \"esri/tasks/QueryTask\";\r\nimport Query from \"esri/tasks/query\";\r\nimport Deferred from \"dojo/Deferred\";\r\nimport StatisticDefinition from \"esri/tasks/StatisticDefinition\"\r\n\r\nconst fontAwesome = document.createElement('script');\r\nfontAwesome.src = 'https://use.fontawesome.com/releases/v5.3.1/js/all.js';\r\ndocument.head.appendChild(fontAwesome);\r\n\r\nlet isFirstLoad = false;\r\n\r\n// To create a widget, you need to derive from BaseWidget.\r\nexport default declare([BaseWidget], {\r\n\r\n  // Custom widget code goes here\r\n\r\n  baseClass: 'dynamic-search-widget-cuna-mas',\r\n\r\n  // add additional properties here\r\n\r\n  // methods to communication with app container:\r\n  postCreate() {\r\n    this.inherited(arguments);\r\n    this.map.on(\"update-end\", this.executeZoomExtentInitial.bind(this));\r\n  },\r\n\r\n  onClickGroup(evt) {\r\n    this.containerGroupsApCs.classList.toggle('active');\r\n    this.containerFiltersApCs.classList.toggle('active');\r\n    this.buildFormSearchCs();\r\n  },\r\n\r\n  onClickBack(evt) {\r\n    this.containerGroupsApCs.classList.toggle('active');\r\n    this.containerFiltersApCs.classList.toggle('active');\r\n    this.destroyFormSearchCs();\r\n  },\r\n\r\n  startup() {\r\n    this.inherited(arguments);\r\n  },\r\n  onOpen() {\r\n    dojo.query(\".groupFilterClsCs\").on('click', this.onClickGroup.bind(this));\r\n    dojo.query(\".backButtonClsCs\").on('click', this.onClickBack.bind(this));\r\n  },\r\n\r\n  executeZoomExtentInitial() {\r\n    if (isFirstLoad) {\r\n      return;\r\n    }\r\n    const homeWidget = WidgetManager.getInstance().getWidgetsByName(\"HomeButton\");\r\n    this.map.setExtent(homeWidget[0].homeDijit.extent);\r\n    isFirstLoad = true;\r\n  },\r\n\r\n  buildFormSearchCs() {\r\n    const filters = this.config.groups[0].filters;\r\n    filters.sort((a, b) => a.index - b.index);\r\n    this.containerBodyApCs.innerHTML = '';\r\n\r\n    let promise = Promise.resolve();\r\n\r\n    filters.forEach((filter) => {\r\n      const label = document.createElement('p');\r\n      label.classList.add('labelComboBoxClsCs');\r\n      label.innerHTML = filter.label;\r\n      this.containerBodyApCs.appendChild(label);\r\n\r\n      const select = document.createElement('select');\r\n      select.classList.add('comboBoxClsCs');\r\n      select.id = filter.codeField;\r\n      // if filter.startupData == true; when execute get data by filter\r\n      if (filter.startupData) {\r\n        promise = promise\r\n          .then(() => this.getDataByFilter(filter.url, [filter.nameField, filter.nameField]))\r\n          .then(response => {\r\n            response.features.forEach(feature => {\r\n              const option = document.createElement('option');\r\n              option.value = feature.attributes[filter.nameField];\r\n              option.innerHTML = feature.attributes[filter.nameField];\r\n              select.appendChild(option);\r\n            });\r\n          })\r\n          .catch(err => {\r\n            console.error('err', err);\r\n          });\r\n\r\n      };\r\n\r\n      // select.addEventListener('change', this.onChangeFilter.bind(this));\r\n      this.containerBodyApCs.appendChild(select);\r\n    });\r\n  },\r\n\r\n  // create function with name getDataByFilter with parameter url and optional parameter \"query\"\r\n  getDataByFilter(url, fields, where = \"1=1\") {\r\n    const deferred = new Deferred();\r\n    const queryTask = new QueryTask(url);\r\n    const query = new Query();\r\n    query.outFields = fields;\r\n    query.where = where;\r\n\r\n    query.returnDistinctValues = true;\r\n\r\n    queryTask.execute(query)\r\n      .then(response => {\r\n        console.log('response', response);\r\n        deferred.resolve(response);\r\n      })\r\n      .catch(err => {\r\n        console.error('err', err);\r\n        deferred.reject(err);\r\n      });\r\n    return deferred.promise;\r\n  },\r\n\r\n  destroyFormSearchCs() {\r\n    this.containerBodyApCs.innerHTML = '';\r\n  }\r\n  // onClose(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onClose');\r\n  // },\r\n  // onMinimize(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onMinimize');\r\n  // },\r\n  // onMaximize(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onMaximize');\r\n  // },\r\n  // onSignIn(credential){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onSignIn', credential);\r\n  // },\r\n  // onSignOut(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onSignOut');\r\n  // }\r\n  // onPositionChange(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::onPositionChange');\r\n  // },\r\n  // resize(){\r\n  //   console.log('DynamicSearchWidgetCunaMas::resize');\r\n  // }\r\n});\r\n"]}